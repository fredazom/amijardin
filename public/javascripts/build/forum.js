$(function(){"use strict";var n=$({}),i=function(){function o(){n.trigger(i.SHOW_EDITOR)}function t(){e.$dom=$(".create-button"),e.$dom.on("click",o)}var e=this;t()};i.SHOW_EDITOR="showEditor";var o=function(){function i(){c.validator=c.$dom.validate({ignore:":hidden:not(#t)",rules:window.questionFormFields.validationRules,messages:{s:{required:"Champ obligatoire",maxlength:"Max {0} digits"},ps:{required:"Champ obligatoire",maxlength:"Max {0} caractères"},e:{required:"Champ obligatoire",maxlength:"Max {0} caractères"},n:{maxlength:"Max {0} caractères"}},highlight:utils.validatorHighlight,unhighlight:utils.validatorUnhighlight}),$.validator.addMethod("extendedemail",utils.emailValidator,"Format erroné: email@example.com"),$.validator.addMethod("textSize",function(n,i,o){var t=1024*o*1024;return i&&i.value&&i.value.length>t?!1:!0},"La taille totale des 'Détails' est limitée à {0} MB")}function s(){c.$dom=$("#question-form"),i(),c.fields.s=new u("s"),c.fields.t=new d("t"),c.fields.ps=new u("ps"),c.fields.e=new u("e"),r=new f,a=new l}var r,a,c=this;c.fields={};var u=function(n){var i=this;i.$dom=$("#"+n),i.isDirty=function(){return""!=i.$dom.val().trim()}},d=function(){var n=this;n.isDirty=function(){var n=$("#t").wysiwyg("shell").getHTML();return"<br>"!=n&&""!=n}},f=function(){function i(i){c.isValid()&&(n.trigger(o.PROCESSING),e=$.ajax({type:"POST",url:"/forum/question/add",data:c.$dom.serialize(),cache:!1}),e.then(function(i,t,e){n.trigger(o.SUCCESS,i)}).fail(function(i,t,e){n.trigger(o.ERROR,e)})),i.preventDefault()}function t(){s.$dom=$("#submit"),s.$dom.on("click",i)}var e,s=this;t()},l=function(){function i(){a.$dom.removeClass("hide")}function s(){a.$dom.addClass("hide")}function r(){a.$dom=$(".error-message")}var a=this;r(),n.on(o.ERROR,i),n.on(o.SUCCESS,s),n.on(t.HIDE_EDITOR,s),n.on(e.EDITOR_CLOSED,s)};c.isDirty=function(){var n=!1;return _.reduce(c.fields,function(n,i,o){return n||i.isDirty()},n)},c.isValid=function(){return c.$dom.valid()},s()};o.PROCESSING="question_processing",o.SUCCESS="question_add_success",o.ERROR="question_add_error";var t=function(){function i(){u.$dom.addClass("show")}function o(){u.$dom.removeClass("show")}function s(){u.$dom=$("#close-question-confirmation")}function r(){s(),a=new d,c=new f}var a,c,u=this,d=function(){function n(){i.$dom=$("#close-question-confirmation .cancel"),i.$dom.on("click",function(){o()})}var i=this;n()},f=function(){function i(){e.$dom=$("#close-question-confirmation .ok"),e.$dom.on("click",function(){o(),n.trigger(t.HIDE_EDITOR)})}var e=this;i()};n.on(e.FORM_DIRTY,i),r()};t.HIDE_EDITOR="hideEditor";var e=function(){function s(){$("#forum-question-section").removeClass("hide")}function r(){$("#forum-question-section").addClass("hide")}function a(){u.isDirty()?n.trigger(e.FORM_DIRTY):(r(),n.trigger(e.EDITOR_CLOSED))}function c(){d=new m,u=new o,f=new l}var u,d,f,l=function(){function i(){s.$dom.removeClass("hide")}function t(){s.$dom.addClass("hide")}function e(){s.$dom=$(".submission-indicator")}var s=this;n.on(o.SUCCESS,t),n.on(o.ERROR,t),n.on(o.PROCESSING,i),e()},m=function(){function n(){i.$dom=$("#cancel"),i.$dom.on("click",a)}var i=this;n()};n.on(i.SHOW_EDITOR,s),n.on(t.HIDE_EDITOR,r),n.on(o.SUCCESS,r),c()};e.FORM_DIRTY="formDirty",e.EDITOR_CLOSED="closeEditor";var s=function(){function s(n){l.$dom.removeClass("hide")}function r(){l.$dom.addClass("hide")}function a(){l.$dom=$("#forum-content-section")}function c(){a(),d=new h,u=new S,f=new m}var u,d,f,l=this,m=function(){function i(){e.$dom.removeClass("hide")}function t(){e.$dom=$(".success-message")}var e=this;t(),n.on(o.SUCCESS,i)},S=function(){function i(n){var i=new Date(Date.parse(n.li)),o=utils.toLocalDateTime(i);s.$dom.prepend("<div><a href='/forum/question/"+n.url+"'>"+n.s+"</a><span class='ps'>"+n.ps+"</span><span class='d'>"+o+"</span></div>")}function o(){var o=$.ajax({type:"GET",url:"/forum/question",cache:!1});o.then(function(o,t,e){try{o=JSON.parse(o),o.forEach(function(n){i(n)}),n.trigger(S.SUCCESS_LOADING_QUESTIONS)}catch(s){n.trigger(S.ERROR_LOADING_QUESTIONS)}}).fail(function(i,o,t){n.trigger(S.ERROR_LOADING_QUESTIONS)})}function t(){s.$dom=$("#forum-content-section .questions")}function e(){t(),o()}var s=this;e()},h=function(){function i(){e.$dom.removeClass("hide")}function o(){e.$dom.addClass("hide")}function t(){e.$dom=$("#forum-content-section .error-message")}var e=this;t(),n.on(S.ERROR_LOADING_QUESTIONS,i),n.on(S.SUCCESS_LOADING_QUESTIONS,o)};S.ERROR_LOADING_QUESTIONS="errorLoadingQuestions",S.SUCCESS_LOADING_QUESTIONS="successLoadingQuestions",c(),n.on(i.SHOW_EDITOR,r),n.on(e.EDITOR_CLOSED,s),n.on(t.HIDE_EDITOR,s),n.on(o.SUCCESS,s)};new e,new i,new s,new t});
//# sourceMappingURL=forum.js.map
