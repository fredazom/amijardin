$(function(){"use strict";function t(){var t=function(){function e(){f.isDirty()?n.trigger(t.DIRTY):n.trigger(t.NOT_DIRTY)}function i(){f.$dom.addClass("hide")}function o(){for(var t in f.fields)f.fields.hasOwnProperty(t)&&f.fields[t].reset()}function r(){o(),i()}function a(){f.validator=f.$dom.validate({ignore:":hidden:not(#t, #qid)",rules:window.responseFormFields.validationRules,messages:{t:{required:"Champ obligatoire",textEmpty:"Champ obligatoire"},ps:{required:"Champ obligatoire",maxlength:"Max {0} caractères"},e:{required:"Champ obligatoire",maxlength:"Max {0} caractères"},qid:{required:"Champ obligatoire",maxlength:"Max {0} caractères"}},highlight:function(t,e){utils.validatorHighlight(t,e),"t"===$(t).attr("name")&&$(".wysiwyg-container").addClass("editor-error")},unhighlight:function(t,e){utils.validatorUnhighlight(t,e),"t"===$(t).attr("name")&&$(".wysiwyg-container").removeClass("editor-error")}}),$.validator.addMethod("extendedemail",utils.emailValidator,"Format erroné: email@example.com"),$.validator.addMethod("textSize",function(t,e,i){var n=1024*i*1024;return e&&e.value&&e.value.length>n?!1:!0},"La taille totale des 'Détails' est limitée à {0} MB"),$.validator.addMethod("textEmpty",function(t,e,i){return""===$(".wysiwyg-editor").text().trim()?!1:!0})}function s(e){if(f.isValid()){var i,o=f.$dom.find("#qid").val();n.trigger(t.PROCESSING),i=$.ajax({type:"POST",url:"/forum/question/"+o+"/response/add",data:f.$dom.serialize(),cache:!1}),i.then(function(e,i,o){n.trigger(t.SUCCESS,e)}).fail(function(e,i,o){n.trigger(t.ERROR,o)})}e.preventDefault()}function d(){f.$dom=$("#response-comment-form"),a(),f.fields.t=new utils.Textarea("#t"),f.fields.ps=new utils.Input("#ps"),f.fields.e=new utils.Input("#e"),u=new utils.Button("#response-comment-form .submit",s),l=new utils.ShowHide("#response-comment-section .error-message"),c=new utils.ShowHide("#response-comment-section .success-message"),m=new utils.Button("#response-comment-form .cancel",function(e){n.trigger(t.CANCEL_PRESSED)})}var u,l,c,m,f=this;f.fields={},f.isDirty=function(){var t=!1;return _.reduce(f.fields,function(t,e,i){return t||e.isDirty()},t)},f.isValid=function(){return f.$dom.valid()},d(),n.on(t.SUCCESS,function(){r(),l.hide(),c.show()}),n.on(t.ERROR,function(){l.show()}),n.on(t.PROCESSING,function(){l.hide()}),n.on(t.CANCEL_PRESSED,e)};t.PROCESSING="question_processing",t.SUCCESS="question_add_success",t.ERROR="question_add_error",t.DIRTY="form-dirty",t.NOT_DIRTY="form-not-dirty",t.CANCEL_PRESSED="cancel-pressed";var e=(new t,new utils.ShowHide("#response-comment-section .submission-indicator")),i=new utils.WarningWindow("#close-response-confirmation",n);n.on(t.DIRTY,i.show),n.on(utils.WarningWindow.OK_PRESSED,function(){window.location.href="/forum"}),n.on(t.NOT_DIRTY,function(){window.location.href="/forum"}),n.on(t.SUCCESS,function(){e.hide()}),n.on(t.ERROR,function(){e.hide()}),n.on(t.PROCESSING,function(){e.show()})}function e(){var t=function(){function e(){u.$dom=$("#question-update-form")}function i(){u.validator=u.$dom.validate({ignore:":hidden:not(#t, #qid, #uid)",rules:window.updateQuestionFormFields.validationRules,messages:{t:{textSize:"La taille du texte est trop grande"},s:{required:"Champ obligatoire",maxlength:"Max {0} caractères"},qid:{required:"Champ obligatoire",maxlength:"Max {0} caractères"},uid:{required:"Champ obligatoire",maxlength:"Max {0} caractères"}},highlight:function(t,e){utils.validatorHighlight(t,e),"t"===$(t).attr("name")&&$(".wysiwyg-container").addClass("editor-error")},unhighlight:function(t,e){utils.validatorUnhighlight(t,e),"t"===$(t).attr("name")&&$(".wysiwyg-container").removeClass("editor-error")}}),$.validator.addMethod("textSize",function(t,e,i){var n=1024*i*1024;return e&&e.value&&e.value.length>n?!1:!0},"La taille totale des 'Détails' est limitée à {0} MB")}function o(e){if(u.isValid()){var i,o=u.$dom.find("#qid").val();n.trigger(t.PROCESSING),i=$.ajax({type:"PUT",url:"/forum/question/"+o+"/update",data:u.$dom.serialize(),cache:!1}),i.then(function(e,i,o){n.trigger(t.SUCCESS,JSON.parse(e))}).fail(function(e,i,o){n.trigger(t.ERROR,o)})}e.preventDefault()}function r(e){n.trigger(t.CANCEL_PRESSED)}function a(){e(),i(),s=new utils.Button("#question-update-form .submit",o),d=new utils.Button("#question-update-form .cancel",r)}var s,d,u=this;u.isValid=function(){return u.$dom.valid()},a()},e=function(t){function e(){i.$dom=$(t)}var i=this;i.show=function(){i.$dom.removeClass("hide")},i.hide=function(){i.$dom.addClass("hide")},i.setContent=function(t){i.$dom.html(t)},e()};t.PROCESSING="update_form_processing",t.SUCCESS="update_form_success",t.ERROR="update_form_error",t.CANCEL_PRESSED="update_form_cancel_pressed",t.EDITOR_BUTTON_PRESSED="update_form_editor_pressed";var i=(new t,new utils.ShowHide("#question-details-container")),o=new utils.ShowHide("#question-update-container"),r=new e(".subject"),a=new utils.ShowHide("#question-update-container .error-message"),s=new utils.ShowHide("#question-update-container .submission-indicator");new utils.Button("#question-details-container .edition-icon",function(){n.trigger(t.EDITOR_BUTTON_PRESSED)});n.on(t.CANCEL_PRESSED,function(){o.hide(),i.show(),r.show()}),n.on(t.EDITOR_BUTTON_PRESSED,function(){o.show(),i.hide(),r.hide()}),n.on(t.SUCCESS,function(t,e){l.populate(e.ed),c.populate(e.t),r.setContent(e.s),r.show(),o.hide(),i.show(),a.hide(),s.hide()}),n.on(t.PROCESSING,function(t,e){a.hide(),s.show()}),n.on(t.ERROR,function(t,e){a.show(),s.hide()})}function i(){var t=function(){function e(){u.$editor.find(".wysiwyg-editor").focus()}function i(){u.validator=u.$dom.validate({ignore:":hidden:not(#t, #qid)",rules:window.responseFormFields.validationRules,messages:{t:{required:"Champ obligatoire",textEmpty:"Champ obligatoire"}},highlight:function(t,e){utils.validatorHighlight(t,e),"t"===$(t).attr("name")&&$(".wysiwyg-container").addClass("editor-error")},unhighlight:function(t,e){utils.validatorUnhighlight(t,e),"t"===$(t).attr("name")&&$(".wysiwyg-container").removeClass("editor-error")}}),$.validator.addMethod("textSize",function(t,e,i){var n=1024*i*1024;return e&&e.value&&e.value.length>n?!1:!0},"La taille totale des 'Détails' est limitée à {0} MB"),$.validator.addMethod("textEmpty",function(t,e,i){return""===$(".wysiwyg-editor").text().trim()?!1:!0})}function o(e){if(u.isValid()){var i,o=u.$dom.find("#qid").val(),r=u.$dom.find("#rid").val();n.trigger(t.PROCESSING),i=$.ajax({type:"PUT",url:"/forum/question/"+o+"/response/"+r+"/update",data:u.$dom.serialize(),cache:!1}),i.then(function(e,i,o){n.trigger(t.SUCCESS,e)}).fail(function(e,i,o){n.trigger(t.ERROR,o)})}e.preventDefault()}function r(){u.$dom=$("#response-comment-update-form"),u.$editor=$("#response-comment-update-form .wysiwyg-container")}function a(){r(),i(),s=new utils.Button("#response-comment-update-form .submit",o),d=new utils.Button("#response-comment-update-form .cancel",function(e){n.trigger(t.CANCEL_PRESSED)}),e()}var s,d,u=this;u.hide=function(){u.$dom.addClass("hide")},u.show=function(){u.$dom.removeClass("hide"),e()},u.isValid=function(){return u.$dom.valid()},a()};t.PROCESSING="update_response_form_processing",t.SUCCESS="update_response_form_success",t.ERROR="update_response_form_error",t.CANCEL_PRESSED="update_response_form_cancel_pressed",t.EDITOR_BUTTON_PRESSED="update_response_form_editor_pressed";var e=new utils.ShowHide("#response-comment-update-container .error-message"),i=new t,o=new u("#response-comment-update-view .text"),r=new a("#response-comment-update-form .editDateFormatted, #response-comment-update-view .editDateFormatted"),s=new utils.ShowHide("#response-comment-update-container .submission-indicator"),d=(new utils.Button("#response-comment-update-view .edition-icon",function(){n.trigger(t.EDITOR_BUTTON_PRESSED)}),new utils.ShowHide("#response-comment-update-view"));d.show=function(){var t=d.$dom.find(".text");d.$dom.removeClass("hide"),t.addClass("highlight-in"),setTimeout(function(){t.addClass("highlight-out")},2e3),setTimeout(function(){t.removeClass("highlight-in highlight-out")},5e3)},n.on(t.SUCCESS,function(t,n){var a=JSON.parse(n);e.hide(),i.hide(),d.show(),o.populate(a.r[0].t),r.populate(a.r[0].ed),s.hide()}),n.on(t.ERROR,function(){e.show(),s.hide()}),n.on(t.PROCESSING,function(){e.hide(),s.show()}),n.on(t.CANCEL_PRESSED,function(){i.hide(),d.show(),e.hide()}),n.on(t.EDITOR_BUTTON_PRESSED,function(){i.show(),d.hide()})}var n=$({}),o=function(t){function e(){i.$dom=$(t)}var i=this;i.getContent=function(){return i.$dom.text()},e()},r=function(){function t(){r.$dom.html(utils.toLocalDateTime(new Date(n.getContent())))}function e(){r.$dom=$(".dateFormatted")}function i(){e(),n=new o("#rawDate"),t()}var n,r=this;i()},a=function(t){function e(){r.$dom.addClass("hide")}function i(){r.$dom.removeClass("hide")}function n(){r.$dom=$(t)}function o(){n()}var r=this;r.populate=function(t){""===t?e():(r.$dom.html(utils.toLocalDateTime(new Date(t))),i())},o()},s=function(){function t(){o.$dom=$("#response-section"),o.$responses=o.$dom.find(".text"),o.$dates=o.$dom.find(".d span")}function e(){o.$responses.each(function(t,e){e=$(e),e.html(e.text())})}function i(){o.$dates.each(function(t,e){var i=$(e);return""===i.html()?void i.addClass("hide"):void i.html(utils.toLocalDateTime(new Date(i.html())))})}function n(){t(),e(),i()}var o=this;n()},d=function(){function t(){e.$dom=$("#rawText")}var e=this;e.getContent=function(){return e.$dom.text()},t()},u=function(t){function e(){a.$dom=$(t)}function i(t){return t=$("<textarea/>").html(t).text()}function n(){a.$dom.removeClass("hide")}function o(){a.$dom.addClass("hide")}function r(){e()}var a=this;a.populate=function(t){var e=i(t);a.$dom.html(e),""===a.$dom.text().trim()?o():n()},r()};new r,new s;var l=new a("#question-details-container .editDateFormatted, #question-update-form .editDateFormatted");l.populate(new o("#rawEditDate").getContent());var c=new u("#textFormatted");c.populate((new d).getContent()),$("#question-update-container").length>0?e():$("#response-comment-update-container").length>0?i():t()});
//# sourceMappingURL=questionTemplate.js.map
